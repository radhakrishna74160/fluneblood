<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fluneblood â€” Blood Group Finder</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
  :root {
    --primary: #be123c;       /* Deep Blood Red */
    --primary-light: #fda4af; /* Soft Pink */
    --bg-dark: #0f172a;       /* Deep Navy */
    --text-dark: #1e293b;
    --text-light: #64748b;
    --white: #ffffff;
    --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
  }

  * { box-sizing: border-box; }

  body {
    margin: 0;
    font-family: 'Plus Jakarta Sans', sans-serif;
    background-color: #f1f5f9;
    color: var(--text-dark);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* --- Layout Architecture --- */
  .auth-container {
    width: 100%;
    max-width: 1100px;
    height: 700px; 
    background: var(--white);
    border-radius: 32px;
    box-shadow: var(--shadow-lg);
    display: grid;
    grid-template-columns: 1.2fr 0.8fr; /* Split Screen for System */
    overflow: hidden;
    position: relative;
    margin: 20px;
  }

  /* --- LEFT PANEL: Brand Visuals --- */
  .visual-panel {
    background: linear-gradient(135deg, #881337 0%, #be123c 100%);
    position: relative;
    padding: 60px;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    color: white;
    overflow: hidden;
  }

  /* Animated Blobs */
  .blob {
    position: absolute;
    border-radius: 50%;
    filter: blur(50px);
    opacity: 0.6;
    animation: float 10s infinite ease-in-out;
  }
  .b1 { width: 350px; height: 350px; background: #fb7185; top: -100px; left: -100px; }
  .b2 { width: 400px; height: 400px; background: #9f1239; bottom: -120px; right: -80px; animation-delay: -2s; }
  
  @keyframes float {
    0%, 100% { transform: translate(0, 0); }
    50% { transform: translate(20px, -20px); }
  }

  /* Brand Text */
  .visual-content { position: relative; z-index: 2; }
  
  .tag {
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    padding: 6px 14px;
    border-radius: 100px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    font-weight: 700;
    margin-bottom: 24px;
    border: 1px solid rgba(255,255,255,0.15);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .dot { width: 8px; height: 8px; background: #4ade80; border-radius: 50%; box-shadow: 0 0 10px #4ade80; }

  .visual-content h1 {
    font-size: 52px;
    font-weight: 800;
    margin: 0;
    line-height: 1.1;
    letter-spacing: -1px;
  }
  
  .visual-content p {
    font-size: 18px;
    opacity: 0.9;
    margin-top: 16px;
    max-width: 450px;
    line-height: 1.6;
    font-weight: 400;
  }

  /* --- RIGHT PANEL: Action --- */
  .action-panel {
    padding: 60px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    position: relative;
    background: var(--white);
  }

  /* Top Logo Area (System View) */
  .top-logo {
    position: absolute;
    top: 40px;
    left: 40px;
    font-weight: 800;
    color: var(--primary);
    font-size: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .login-box { width: 100%; max-width: 380px; }
  .login-box h2 { font-size: 32px; margin: 0 0 10px 0; color: var(--text-dark); letter-spacing: -0.5px; }
  .login-box p { color: var(--text-light); margin: 0 0 40px 0; font-size: 16px; line-height: 1.5; }

  /* Google Button */
  .googleBtn {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    padding: 16px;
    border-radius: 16px;
    border: 2px solid #e2e8f0;
    background: white;
    cursor: pointer;
    font-weight: 700;
    font-size: 16px;
    color: var(--text-dark);
    transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
  }
  .googleBtn:hover {
    border-color: #cbd5e1;
    transform: translateY(-2px);
    box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.05);
    background: #f8fafc;
  }
  .googleBtn:active { transform: translateY(0); }

  /* Messages */
  .status-msg { margin-top: 20px; font-size: 14px; font-weight: 600; min-height: 24px; color: var(--primary); }
  
  .secure-badge {
    margin-top: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    font-size: 12px;
    color: var(--text-light);
    opacity: 0.8;
  }

  /* --- MOBILE / PHONE RESPONSIVENESS --- */
  @media (max-width: 900px) {
    body { background: #fff; } /* Clean white background on mobile */
    
    .auth-container { 
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-width: 100%;
      margin: 0;
      border-radius: 0;
      box-shadow: none;
    }

    /* Mobile Header */
    .visual-panel { 
      flex: 0 0 35%; /* Takes top 35% of screen */
      padding: 30px; 
      justify-content: center;
      align-items: center;
      text-align: center;
      border-radius: 0 0 30px 30px; /* Modern curve at bottom */
      z-index: 1;
    }

    .visual-content h1 { font-size: 32px; }
    .visual-content p { display: none; } /* Hide description on phones to save space */
    .tag { display: none; } /* Simplify mobile view */

    /* Mobile Content */
    .action-panel {
      flex: 1;
      padding: 40px 24px;
      margin-top: -20px; /* Slight overlap */
      border-radius: 30px 30px 0 0;
      z-index: 2;
      justify-content: flex-start; /* Start from top */
      padding-top: 60px;
    }
    
    .top-logo { display: none; } /* Hide duplicate logo on mobile */
    .login-box h2 { font-size: 26px; }
  }
</style>
</head>
<body>

  <div class="auth-container">
    
    <div class="visual-panel">
      <div class="blob b1"></div>
      <div class="blob b2"></div>

      <div class="visual-content">
        <div class="tag"><div class="dot"></div> Online Now</div>
        <h1 id="title">Fluneblood</h1>
        <p>Connecting donors, hospitals, and patients in a unified real-time network.</p>
      </div>
    </div>

    <div class="action-panel">
      
      <div class="top-logo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/><path d="M12 5v14"/><path d="M5 12h14"/></svg>
        Blood Group Finder
      </div>

      <div class="login-box">
        <h2>Welcome Back</h2>
        <p>Sign in securely to access the directory.</p>

        <div id="btnGoogle" class="googleBtn" role="button" aria-label="Continue with Google">
          <svg width="24" height="24" viewBox="0 0 533.5 544.3"><path fill="#4285f4" d="M533.5 278.4c0-18.5-1.5-37.2-4.7-55.1H272v104.2h146.9c-6.4 34.6-25.9 64-55.2 83.6v69.6h89.1c52.1-47.9 82.7-118.8 82.7-202.3z"/><path fill="#34a853" d="M272 544.3c74 0 136.1-24.6 181.5-66.9l-89.1-69.6c-24.8 16.6-56.8 26.4-92.4 26.4-71 0-131.2-47.9-152.7-112.3H29.1v70.7C74.6 487.4 169.2 544.3 272 544.3z"/><path fill="#fbbc04" d="M119.3 328.2c-10.8-32.7-10.8-68 0-100.7v-70.7H29.1C10.3 203.6 0 239.3 0 276.4s10.3 72.8 29.1 106.9l90.2-55.1z"/><path fill="#ea4335" d="M272 108.8c39.8 0 75.6 13.7 103.8 40.6l77.7-77.7C405.7 24.5 344 0 272 0 169.2 0 74.6 56.9 29.1 142.1l90.2 70.7C140.8 156.7 201 108.8 272 108.8z"/></svg>
          Continue with Google
        </div>
        
        <div id="msg" class="status-msg" aria-live="polite"></div>
      </div>

      <div class="secure-badge">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
        Secured by Firebase
      </div>

    </div>
  </div>

<script type="module">
/* Firebase modular imports */
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import {
  getAuth,
  GoogleAuthProvider,
  signInWithPopup,
  signInWithRedirect,
  getRedirectResult,
  onAuthStateChanged,
  setPersistence,
  browserLocalPersistence
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

/* Firebase config (use your keys) */
const firebaseConfig = {
  apiKey: "AIzaSyB3xlua10Vnqrf0kXrwXa-I02nkVSC8nWo",
  authDomain: "fluneblood.firebaseapp.com",
  projectId: "fluneblood",
  storageBucket: "fluneblood.firebasestorage.app",
  messagingSenderId: "617024386176",
  appId: "1:617024386176:web:b87ee71140ad1adba8a265",
  measurementId: "G-751TFG0GZQ"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const googleBtn = document.getElementById('btnGoogle');
const msg = document.getElementById('msg');

function log(s){ console.log('[BGF]', s); msg.textContent = s || ''; }

// set persistence (IIFE to avoid top-level await)
(async function(){
  try{ await setPersistence(auth, browserLocalPersistence); log(''); }
  catch(e){ console.warn('setPersistence failed', e); log('Auth persistence fallback'); }
})();

// ensure minimal user doc exists
async function ensureUserDoc(user){
  if(!user || !user.uid) return;
  try{
    const ref = doc(db, 'users', user.uid);
    const snap = await getDoc(ref);
    if(!snap.exists()){
      await setDoc(ref, { email: user.email || null, createdAt: serverTimestamp(), isAdmin: false }, { merge: true });
      log('Creating profile...');
    } else {
      log('Loading profile...');
    }
  }catch(err){ console.error('ensureUserDoc', err); log('DB error: ' + (err.message||err.code)); }
}

// Google sign-in flow: popup, fallback to redirect
googleBtn.addEventListener('click', async ()=>{
  log('Connecting to Google...');
  const provider = new GoogleAuthProvider();
  try{
    const res = await signInWithPopup(auth, provider);
    log('Success! Redirecting...');
    await ensureUserDoc(res.user);
    // onAuthStateChanged will redirect
  }catch(err){
    console.warn('Popup failed', err);
    log('Popup failed, trying redirect...');
    try{ await signInWithRedirect(auth, provider); }catch(e){ console.error('Redirect failed', e); log('Google sign-in failed'); }
  }
});

// handle redirect result if present
(async function handleRedirect(){
  try{
    const r = await getRedirectResult(auth);
    if(r && r.user){ await ensureUserDoc(r.user); log('Success! Redirecting...'); }
  }catch(e){ /* ignore */ }
})();

// when signed in, redirect to directory
onAuthStateChanged(auth, async (user)=>{
  if(user){
    log('Verified: ' + user.email);
    await ensureUserDoc(user);
    setTimeout(()=> window.location.href = 'blood-finder.html', 800);
  } else {
    log('');
  }
});
</script>
</body>
</html>
